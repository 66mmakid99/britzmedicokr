---
import { mainNav } from '@data/navigation';

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 border-b border-slate-100 bg-white/80 backdrop-blur-lg">
  <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-4 sm:px-6 lg:px-8">
    <!-- 로고 -->
    <a href="/" class="flex items-center gap-3">
      <span class="text-xl font-bold tracking-widest text-slate-900">BRITZMEDI</span>
      <span class="hidden h-5 w-px bg-slate-200 sm:block"></span>
      <span class="hidden text-xs uppercase tracking-wider text-slate-400 sm:block">RF Medical Device</span>
    </a>

    <!-- 데스크톱 네비게이션 -->
    <nav class="hidden lg:flex lg:items-center lg:gap-1" aria-label="메인 메뉴">
      {mainNav.map((item) =>
        'children' in item ? (
          <div class="group relative">
            <button class="flex items-center gap-1 px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:text-blue-700">
              {item.label}
              <svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="invisible absolute left-0 top-full z-50 min-w-[200px] rounded-xl border border-slate-100 bg-white py-3 shadow-xl opacity-0 transition-all group-hover:visible group-hover:opacity-100">
              {item.children.map((child) => (
                <a
                  href={child.href}
                  class:list={[
                    'block px-5 py-2.5 text-sm transition-colors hover:bg-slate-50 hover:text-blue-700',
                    currentPath === child.href ? 'font-semibold text-blue-700' : 'text-slate-600',
                  ]}
                >
                  {child.label}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a
            href={item.href}
            class:list={[
              'px-4 py-2 text-sm font-medium transition-colors hover:text-blue-700',
              currentPath === item.href ? 'text-blue-700' : 'text-slate-600',
            ]}
          >
            {item.label}
          </a>
        )
      )}
    </nav>

    <!-- CTA + 모바일 메뉴 토글 -->
    <div class="flex items-center gap-3">
      <a href="/contact" class="hidden rounded-lg bg-blue-700 px-5 py-2.5 text-sm font-semibold text-white transition-colors hover:bg-blue-800 sm:inline-block">
        상담 신청
      </a>
      <button id="mobile-menu-toggle" class="rounded-lg p-2 transition-colors hover:bg-slate-50 lg:hidden" aria-label="메뉴 열기">
        <svg class="h-6 w-6 text-slate-900" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- 모바일 네비게이션 -->
  <div id="mobile-menu" class="hidden border-t border-slate-100 bg-white lg:hidden">
    <nav class="mx-auto max-w-7xl px-4 py-4 sm:px-6" aria-label="모바일 메뉴">
      {mainNav.map((item) =>
        'children' in item ? (
          <div class="border-b border-slate-50">
            <p class="px-2 py-3 text-sm font-semibold text-slate-900">{item.label}</p>
            {item.children.map((child) => (
              <a
                href={child.href}
                class:list={[
                  'block px-6 py-2 text-sm transition-colors hover:text-blue-700',
                  currentPath === child.href ? 'font-semibold text-blue-700' : 'text-slate-500',
                ]}
              >
                {child.label}
              </a>
            ))}
          </div>
        ) : (
          <a
            href={item.href}
            class:list={[
              'block border-b border-slate-50 px-2 py-3 text-sm font-medium transition-colors hover:text-blue-700',
              currentPath === item.href ? 'text-blue-700' : 'text-slate-600',
            ]}
          >
            {item.label}
          </a>
        )
      )}
      <a href="/contact" class="mt-4 block rounded-lg bg-blue-700 py-3 text-center text-sm font-semibold text-white transition-colors hover:bg-blue-800">
        상담 신청
      </a>
    </nav>
  </div>
</header>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  toggle?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
