---
import { mainNav } from '@data/navigation';

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 border-b border-gray-100 bg-white/95 backdrop-blur-sm">
  <div class="mx-auto flex max-w-[1280px] items-center justify-between px-4 py-4 md:px-8">
    <!-- 로고 -->
    <a href="/" class="flex items-center gap-2">
      <span class="text-xl font-bold tracking-tight text-primary">BRITZMEDI</span>
    </a>

    <!-- 데스크톱 네비게이션 -->
    <nav class="hidden lg:flex lg:items-center lg:gap-1" aria-label="메인 메뉴">
      {mainNav.map((item) =>
        'children' in item ? (
          <div class="group relative">
            <button class="flex items-center gap-1 rounded-lg px-4 py-2 text-sm font-medium text-text hover:bg-surface hover:text-primary">
              {item.label}
              <svg class="h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="invisible absolute left-0 top-full z-50 min-w-[180px] rounded-lg border border-gray-100 bg-white py-2 shadow-lg opacity-0 transition-all group-hover:visible group-hover:opacity-100">
              {item.children.map((child) => (
                <a
                  href={child.href}
                  class:list={[
                    'block px-4 py-2 text-sm hover:bg-surface hover:text-primary',
                    currentPath === child.href ? 'font-semibold text-primary' : 'text-text-muted',
                  ]}
                >
                  {child.label}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a
            href={item.href}
            class:list={[
              'rounded-lg px-4 py-2 text-sm font-medium hover:bg-surface hover:text-primary',
              currentPath === item.href ? 'text-primary' : 'text-text',
            ]}
          >
            {item.label}
          </a>
        )
      )}
    </nav>

    <!-- CTA + 모바일 메뉴 토글 -->
    <div class="flex items-center gap-3">
      <a href="/contact" class="hidden rounded-lg bg-primary px-5 py-2 text-sm font-medium text-white hover:bg-secondary sm:inline-block">
        상담 신청
      </a>
      <button id="mobile-menu-toggle" class="rounded-lg p-2 hover:bg-surface lg:hidden" aria-label="메뉴 열기">
        <svg class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- 모바일 네비게이션 -->
  <div id="mobile-menu" class="hidden border-t border-gray-100 bg-white lg:hidden">
    <nav class="mx-auto max-w-[1280px] px-4 py-4" aria-label="모바일 메뉴">
      {mainNav.map((item) =>
        'children' in item ? (
          <div class="border-b border-gray-50">
            <p class="px-2 py-3 text-sm font-semibold text-primary">{item.label}</p>
            {item.children.map((child) => (
              <a
                href={child.href}
                class:list={[
                  'block px-6 py-2 text-sm hover:text-primary',
                  currentPath === child.href ? 'font-semibold text-primary' : 'text-text-muted',
                ]}
              >
                {child.label}
              </a>
            ))}
          </div>
        ) : (
          <a
            href={item.href}
            class:list={[
              'block border-b border-gray-50 px-2 py-3 text-sm font-medium hover:text-primary',
              currentPath === item.href ? 'text-primary' : 'text-text',
            ]}
          >
            {item.label}
          </a>
        )
      )}
      <a href="/contact" class="mt-4 block rounded-lg bg-primary py-3 text-center text-sm font-medium text-white">
        상담 신청
      </a>
    </nav>
  </div>
</header>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  toggle?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
