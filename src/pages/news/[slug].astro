---
import BaseLayout from '@layouts/BaseLayout.astro';
import SchemaOrg from '@components/aeo/SchemaOrg.astro';
import Breadcrumb from '@components/common/Breadcrumb.astro';
import UpdateDate from '@components/common/UpdateDate.astro';
import RelatedContent from '@components/common/RelatedContent.astro';
import { getAllNews, getNewsBySlug } from '@data/news';
import { company } from '@data/company';
import { formatDateKo } from '@lib/utils';

export function getStaticPaths() {
  const newsItems = getAllNews();
  return newsItems.map((item) => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
const news = getNewsBySlug(slug as string);

if (!news) {
  return Astro.redirect('/news');
}

const newsArticleSchema = {
  '@context': 'https://schema.org',
  '@type': 'NewsArticle',
  headline: news.title,
  description: news.excerpt,
  url: `${company.url}/news/${news.slug}`,
  datePublished: news.publishedAt,
  dateModified: news.publishedAt,
  author: {
    '@type': 'Organization',
    name: company.name,
  },
  publisher: {
    '@type': 'Organization',
    name: company.name,
    logo: { '@type': 'ImageObject', url: `${company.url}${company.logo}` },
  },
};
---

<BaseLayout title={news.title} description={news.excerpt}>
  <SchemaOrg schema={newsArticleSchema} slot="head" />

  <div class="mx-auto max-w-[1280px] px-4 py-12 md:px-8">
    <Breadcrumb items={[
      { name: '뉴스', href: '/news' },
      { name: news.title, href: `/news/${news.slug}` },
    ]} />

    <article>
      <div class="mb-4 flex items-center gap-3">
        <time datetime={news.publishedAt} class="text-sm font-medium text-accent">
          {formatDateKo(news.publishedAt)}
        </time>
        <span class="inline-block rounded-full bg-surface px-3 py-1 text-xs font-semibold text-text-muted">
          {news.category}
        </span>
      </div>

      <h1 class="mb-8 text-3xl font-bold text-primary md:text-4xl">
        {news.title}
      </h1>

      <div class="prose prose-lg max-w-none text-text-muted leading-relaxed [&>h2]:mt-10 [&>h2]:mb-4 [&>h2]:text-2xl [&>h2]:font-bold [&>h2]:text-primary [&>p]:mb-4 [&>ul]:mb-4 [&>ul]:list-none [&>ul]:space-y-1 [&>ul>li]:text-text-muted">
        <Fragment set:html={news.content} />
      </div>
    </article>

    <UpdateDate date={news.publishedAt} />

    <RelatedContent
      title="다른 뉴스 보기"
      items={[
        { title: '뉴스 전체 목록', href: '/news', description: "브리츠메디의 최신 소식을 확인하세요." },
        { title: '블로그', href: '/blog', description: 'RF 기술 가이드와 시술 정보를 확인하세요.' },
        { title: '회사소개', href: '/about', description: "브리츠메디에 대해 더 알아보세요." },
      ]}
    />
  </div>
</BaseLayout>
